datasource db {
  provider = "postgresql"
  url = env("POSTGRES_PRISMA_URL") // uses connection pooling
  directUrl = env("POSTGRES_URL_NON_POOLING") // uses a direct connection
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id            String            @id
  email         String            @unique
  name          String     
  password      String
  ownedEvents   Event[]
  followedBy    Follows[]         @relation("followedBy")
  following     Follows[]         @relation("following")
  attendances   Attendance[]
}

model Follows {
  followedBy    User              @relation("followedBy", fields: [followedById], references: [id])
  followedById  String
  following     User              @relation("following", fields: [followingId], references: [id])
  followingId   String
  status        String            @default("pending")

  @@id([followingId, followedById])
}

model Event {
  id            String            @id
  name          String            
  description   String     
  owner         User              @relation(fields: [ownerId], references: [id])
  ownerId       String
  schedules     Schedule[]
  attendances   Attendance[]
}

model Attendance {
  attendee      User              @relation(fields: [attendeeId], references: [id])
  attendeeId    String
  event         Event             @relation(fields: [eventId], references: [id])
  eventId       String
  schedule      Schedule          @relation(fields: [scheduleId], references: [id])
  scheduleId    String
  @@id([attendeeId, eventId])  
}

model Schedule {
  id            String            @id
  name          String            
  event         Event             @relation(fields: [eventId], references: [id])
  eventId       String
  sessions      Session[]
  attendances   Attendance[]
  @@unique([eventId,name])
}

model Session {
  id            String            @id
  place         String
  timeZone      String
  startTime     DateTime          @db.Time(3)
  endTime       DateTime          @db.Time(3)
  startDate     DateTime          @db.Date
  endDate       DateTime          @db.Date
  interval      Int
  schedule      Schedule          @relation(fields: [scheduleId], references: [id])
  scheduleId    String
}